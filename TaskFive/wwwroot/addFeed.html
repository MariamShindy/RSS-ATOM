<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSS/ATOM Reader</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="Css/Style.css">
    <script src="https://unpkg.com/htmx.org@1.6.1/dist/htmx.js" crossorigin="anonymous"></script>
</head>
<body class="addFeedBody">
    <div class="d-flex justify-content-between align-items-center">
        <a id="btn-Logout" class="btn btn-outline-danger ms-auto" href="index.html">Logout</a>
    </div>
    <br><br>
    <div id="addFeed-section">

        <h2 class="addFeedHeader">addFeed</h2> <br>
        <form id="addFeedForm" class="mb-3" hx-post="/feeds" hx-target="#feed-list"hx-trigger="submit" hx-swap="innerHTML" hx-headers='{"Content-Type": "application/x-www-form-urlencoded"}'>
            <div class="mb-3">
                <label for="addFeed-input" class="form-label" id="addFeed-label">Feed Url</label>
                <input type="text" id="addFeed-input" class="form-control" name="url" required>
            </div>
            <br>
            <button type="submit" class="btn-addFeed">ADD FEED</button>
        </form>
    </div>
    <ul id="feed-list" class="list-group">
        <!-- User Feeds will be loaded here -->
    </ul>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            fetchFeeds();
        });

        function fetchFeeds() {
            fetch('/getFeeds', {
                method: 'POST'
            })
                .then(response => {
                    if (response.status === 401) {
                        window.location.href = '/login.html';
                    } else {
                        return response.json();
                    }
                })
                .then(feeds => {
                    const feedList = document.getElementById('feed-list');
                    feedList.innerHTML = '';
                    feeds.forEach(feed => {
                        const feedItem = document.createElement('li');
                        feedItem.className = 'list-group-item d-flex justify-content-between align-items-center';
                        feedItem.innerHTML = `${feed.url} <button class='btn btn-danger btn-sm' onclick='removeFeed(${feed.id})'>Remove</button>`;
                        feedList.appendChild(feedItem);
                    });
                });
        }

        function removeFeed(feedId) {
            fetch('/removeFeed', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: new URLSearchParams({ feedId: feedId })
            })
                .then(response => {
                    if (response.ok) {
                        fetchFeeds();
                    } else {
                        console.error('Failed to remove feed');
                    }
                });
        }
    </script>
</body>
</html>
